<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WuWa Image Gallery</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0a0a;
            color: #e0e0e0;
            font-family: 'Segoe UI', sans-serif;
        }

        .toolbar {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(12px);
            padding: 1rem 2rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            border-bottom: 1px solid #222;
            flex-wrap: wrap;
        }

        .toolbar input[type="text"] {
            flex: 1;
            min-width: 200px;
            padding: 0.6rem 1rem;
            border-radius: 8px;
            border: 1px solid #333;
            background: #151515;
            color: white;
            font-size: 0.95rem;
            outline: none;
        }

        .toolbar input:focus {
            border-color: #666;
        }

        .toolbar .count {
            color: #888;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .toolbar select {
            padding: 0.5rem;
            border-radius: 8px;
            border: 1px solid #333;
            background: #151515;
            color: white;
            font-size: 0.85rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 4px;
            padding: 1rem;
        }

        .grid.size-sm {
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        }

        .grid.size-lg {
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        }

        .grid.size-xl {
            grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
        }

        .card {
            position: relative;
            background: #111;
            border: 1px solid #1a1a1a;
            overflow: hidden;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .card:hover {
            border-color: #555;
        }

        .card img {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            display: block;
            background: #0d0d0d;
            transition: transform 0.3s;
        }

        .card:hover img {
            transform: scale(1.05);
        }

        .card .label {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 0.5rem;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
            font-size: 0.7rem;
            color: #ccc;
            word-break: break-all;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .card:hover .label {
            opacity: 1;
        }

        .card .copy-btn {
            position: absolute;
            top: 6px;
            right: 6px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #444;
            color: #ccc;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .card:hover .copy-btn {
            opacity: 1;
        }

        .copy-btn:hover {
            background: #333;
            color: white;
        }

        .copy-btn.copied {
            background: #1a6;
            color: white;
        }

        /* Lightbox */
        .lightbox {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 999;
            background: rgba(0, 0, 0, 0.95);
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 1rem;
        }

        .lightbox.active {
            display: flex;
        }

        .lightbox img {
            max-width: 90vw;
            max-height: 80vh;
            object-fit: contain;
            border-radius: 8px;
        }

        .lightbox .info {
            color: #aaa;
            font-size: 0.9rem;
            text-align: center;
            max-width: 90vw;
            word-break: break-all;
        }

        .lightbox .info a {
            color: #6af;
        }

        .lightbox .close-btn {
            position: absolute;
            top: 1.5rem;
            right: 2rem;
            font-size: 2rem;
            color: white;
            cursor: pointer;
            background: none;
            border: none;
        }

        .loading-msg {
            text-align: center;
            padding: 4rem;
            color: #666;
            font-size: 1.2rem;
        }
    </style>
</head>

<body>
    <div class="toolbar">
        <input type="text" id="search" placeholder="Search by key name... (e.g. camellya, splash, icon, card)"
            autofocus>
        <select id="sizeSelect">
            <option value="size-sm">Small</option>
            <option value="" selected>Medium</option>
            <option value="size-lg">Large</option>
            <option value="size-xl">X-Large</option>
        </select>
        <span class="count" id="count">Loading...</span>
    </div>

    <div class="grid" id="grid"></div>

    <div class="lightbox" id="lightbox">
        <button class="close-btn" onclick="closeLightbox()">Ã—</button>
        <img id="lb-img" src="" alt="">
        <div class="info">
            <div id="lb-key"></div>
            <div><a id="lb-url" href="#" target="_blank">Open original URL</a></div>
        </div>
    </div>

    <p class="loading-msg" id="loadingMsg">Loading image map...</p>

    <script type="module">
        // Import the image map
        import { IMAGE_MAP } from './src/utils/image_map.js';

        // Audio / video extensions to filter out
        const SKIP_EXT = ['.ogg', '.mp3', '.wav', '.mp4', '.webm', '.flac', '.aac'];

        function isAudio(url) {
            const lower = url.toLowerCase();
            return SKIP_EXT.some(ext => lower.includes(ext));
        }

        // Build filtered entries
        const entries = Object.entries(IMAGE_MAP)
            .filter(([key, url]) => !isAudio(url))
            .sort((a, b) => a[0].localeCompare(b[0]));

        const totalCount = Object.keys(IMAGE_MAP).length;
        const filteredCount = entries.length;

        const grid = document.getElementById('grid');
        const search = document.getElementById('search');
        const count = document.getElementById('count');
        const sizeSelect = document.getElementById('sizeSelect');
        const lightbox = document.getElementById('lightbox');
        const lbImg = document.getElementById('lb-img');
        const lbKey = document.getElementById('lb-key');
        const lbUrl = document.getElementById('lb-url');
        const loadingMsg = document.getElementById('loadingMsg');

        // Render
        let currentFilter = '';
        let visibleEntries = entries;

        function render() {
            const q = search.value.trim().toLowerCase();
            if (q !== currentFilter) {
                currentFilter = q;
                if (q) {
                    const terms = q.split(/\s+/);
                    visibleEntries = entries.filter(([key]) =>
                        terms.every(t => key.includes(t))
                    );
                } else {
                    visibleEntries = entries;
                }
            }

            count.textContent = `${visibleEntries.length} / ${filteredCount} images (${totalCount - filteredCount} audio skipped)`;

            // Only render first 500 for performance, load more on scroll
            const batch = visibleEntries.slice(0, renderLimit);
            grid.innerHTML = '';

            for (const [key, url] of batch) {
                const card = document.createElement('div');
                card.className = 'card';

                const img = document.createElement('img');
                img.loading = 'lazy';
                img.referrerPolicy = 'no-referrer';
                img.alt = key;
                img.src = url;
                img.onerror = () => { img.style.display = 'none'; };

                const label = document.createElement('div');
                label.className = 'label';
                label.textContent = key;

                const copyBtn = document.createElement('button');
                copyBtn.className = 'copy-btn';
                copyBtn.textContent = 'Copy Key';
                copyBtn.onclick = (e) => {
                    e.stopPropagation();
                    navigator.clipboard.writeText(key).then(() => {
                        copyBtn.textContent = 'Copied!';
                        copyBtn.classList.add('copied');
                        setTimeout(() => {
                            copyBtn.textContent = 'Copy Key';
                            copyBtn.classList.remove('copied');
                        }, 1500);
                    });
                };

                card.onclick = () => openLightbox(key, url);
                card.appendChild(img);
                card.appendChild(label);
                card.appendChild(copyBtn);
                grid.appendChild(card);
            }
        }

        let renderLimit = 200;

        function openLightbox(key, url) {
            lbImg.src = url;
            lbKey.textContent = key;
            lbUrl.href = url;
            lightbox.classList.add('active');
        }

        window.closeLightbox = () => {
            lightbox.classList.remove('active');
            lbImg.src = '';
        };

        lightbox.onclick = (e) => {
            if (e.target === lightbox) closeLightbox();
        };

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeLightbox();
        });

        // Size toggle
        sizeSelect.onchange = () => {
            grid.className = 'grid ' + sizeSelect.value;
        };

        // Search debounce
        let debounceTimer;
        search.oninput = () => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                renderLimit = 200;
                render();
            }, 250);
        };

        // Infinite scroll
        window.addEventListener('scroll', () => {
            if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 500) {
                if (renderLimit < visibleEntries.length) {
                    renderLimit += 200;
                    render();
                }
            }
        });

        // Initial render
        loadingMsg.style.display = 'none';
        render();
    </script>
</body>

</html>